<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çŒ´å­æ‰¾æ°´æœ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
            background: #000;
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
            overflow-x: hidden; /* ç¦æ­¢æ°´å¹³æ»šåŠ¨ */
        }
        
        /* æ£®æ—èƒŒæ™¯ */
        .forest-background {
            width: 100%;
            height: 100%;
            background-image: url('forest.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* æ¸¸æˆä¿¡æ¯é¢æ¿ */
        .game-info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 30px;
            border-radius: 25px;
            text-align: center;
            z-index: 150; /* æé«˜å±‚çº§ï¼Œç¡®ä¿æ–‡å­—ä¸è¢«é®æŒ¡ */
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        /* ç©å®¶ä¿¡æ¯ */
        .player-info {
            display: flex;
            justify-content: space-around;
            position: absolute;
            top: 20px;
            width: 100%;
            padding: 0 20px;
            z-index: 100;
        }
        
        .player {
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 20px;
            text-align: center;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }
        
        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 5px;
            background-size: cover;
            background-position: center;
            border: 3px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .player-name {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .player-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        /* æ¸¸æˆçŠ¶æ€ */
        .game-status {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 25px;
            text-align: center;
            z-index: 150; /* æé«˜å±‚çº§ï¼Œç¡®ä¿æ–‡å­—ä¸è¢«é®æŒ¡ */
            backdrop-filter: blur(10px);
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }
        
        /* éš¾åº¦é€‰æ‹© */
        .difficulty-selector {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 150; /* æé«˜å±‚çº§ï¼Œç¡®ä¿æ–‡å­—ä¸è¢«é®æŒ¡ */
            backdrop-filter: blur(10px);
        }
        
        .difficulty-buttons {
            display: flex;
            gap: 10px;
        }
        
        .difficulty-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .difficulty-btn.active {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border-color: #ffd700;
        }
        
        /* æ ‡å¿—æ ·å¼ */
        .flag {
            position: absolute;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            animation: float 3s ease-in-out infinite;
        }
        
        .balloon {
            position: absolute;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }
        
        .flag:hover,
        .balloon:hover {
            transform: scale(1.2) translateY(-5px);
            animation: none;
        }
        
        /* é¢œè‰²ç±» */
        .red {
            color: #ff4757;
        }
        
        .blue {
            color: #3742fa;
        }
        
        .purple {
            color: #a55eea;
        }
        
        /* æ°´æœæ ·å¼ */
        .fruit {
            position: absolute;
            font-size: 3rem;
            z-index: 60;
            animation: fruitAppear 0.5s ease-in-out;
        }
        
        @keyframes fruitAppear {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }
        
        /* æ°´æœä»·å€¼æ˜¾ç¤º */
        .fruit-value {
            position: absolute;
            font-size: 1rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 70;
            animation: valueFloat 1s ease-out forwards;
        }
        
        @keyframes valueFloat {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }
        
        /* æ‰‹æœºæ¨ªå±æç¤ºæ ·å¼ */
        .orientation-hint {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.3s ease;
        }
        
        .orientation-content {
            text-align: center;
            color: white;
            padding: 20px;
        }
        
        .orientation-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: rotate 3s ease-in-out infinite;
        }
        
        .orientation-text {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: bold;
            color: #fff;
        }
        
        .orientation-subtext {
            font-size: 1rem;
            color: #ccc;
            opacity: 0.8;
        }
        
        /* æ—‹è½¬åŠ¨ç”» */
        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }
        
        /* åœ¨æ¨ªå±æ¨¡å¼ä¸‹éšè—æç¤º */
        @media screen and (orientation: landscape) {
            .orientation-hint {
                display: none;
            }
        }
        
        /* é’ˆå¯¹iPhoneçš„ç‰¹æ®Šå¤„ç† */
        @media screen and (max-device-width: 430px) and (orientation: portrait) {
            .orientation-hint {
                display: flex;
            }
        }
        
        /* é’ˆå¯¹iPadçš„ç‰¹æ®Šå¤„ç† */
        @media screen and (min-device-width: 768px) and (max-device-width: 1024px) and (orientation: portrait) {
            .orientation-hint {
                display: flex;
            }
        }
        
        /* æ¡Œé¢è®¾å¤‡éšè—æç¤º */
        @media screen and (min-device-width: 1025px) {
            .orientation-hint {
                display: none;
            }
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2d5016, #639a67);
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.5s ease;
            margin: 20px auto;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-title {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        .modal-text {
            font-size: 1.1rem;
            margin: 15px 0;
        }
        
        /* é’ˆå¯¹å°å±å¹•è®¾å¤‡çš„å“åº”å¼è°ƒæ•´ */
        @media screen and (max-device-width: 430px) {
            .modal-title {
                font-size: 1.5rem;
            }
            
            .modal-text {
                font-size: 1rem;
            }
            
            .avatar-selection {
                gap: 10px;
            }
            
            .avatar-option {
                width: 80px;
                height: 80px;
            }
            
            .continue-btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }
        
        .winner-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 20px auto;
            background-size: cover;
            background-position: center;
            border: 4px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }
        
        /* æˆ˜å†µè¯¦æƒ…æ ·å¼ */
        .battle-records-list {
            margin: 20px 0;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* æ¯è½®æˆ˜å†µæ ·å¼ */
        .round-record {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
        }
        
        /* è½®æ¬¡æ ‡é¢˜ */
        .round-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #ffd700;
        }
        
        /* ç©å®¶é€‰æ‹©æ ·å¼ */
        .player-selections {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        /* å•ä¸ªç©å®¶é€‰æ‹©æ ·å¼ */
        .player-selection {
            background: rgba(0, 0, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        /* é’ˆå¯¹å°å±å¹•è®¾å¤‡çš„å¯»å®è¯¦æƒ…è°ƒæ•´ */
        @media screen and (max-device-width: 430px) {
            .battle-records-list {
                max-height: 300px;
            }
            
            .round-title {
                font-size: 1rem;
            }
            
            .player-selections {
                flex-direction: column;
                gap: 10px;
            }
            
            .player-selection {
                min-width: auto;
            }
            
            .fruit-info {
                flex-direction: column;
                gap: 5px;
            }
            
            .fruit-emoji {
                font-size: 1.5rem;
            }
        }
        
        /* ç©å®¶åç§° */
        .player-selection .player-name {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        /* æ°´æœä¿¡æ¯ */
        .fruit-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* æ°´æœè¡¨æƒ… */
        .fruit-info .fruit-emoji {
            font-size: 2rem;
        }
        
        /* æ°´æœè¯¦æƒ… */
        .fruit-details {
            text-align: left;
        }
        
        .continue-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 12px 24px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        /* å¤´åƒé€‰æ‹©æ ·å¼ */
        .avatar-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .avatar-option {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .avatar-option:hover {
            border-color: #ffd700;
            transform: scale(1.1);
        }
        
        .avatar-option.selected {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transform: scale(1.1);
        }
        
        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- æ£®æ—èƒŒæ™¯ -->
        <div class="forest-background"></div>
        
        <!-- ç©å®¶ä¿¡æ¯ -->
        <div class="player-info">
            <div class="player player1">
                <div class="player-avatar" id="player1-avatar"></div>
                <div class="player-name">å°çŒ´å­1å·</div>
                <div class="player-score" id="player1-score">0</div>
                <div>é‡‘å¸</div>
            </div>
            <div class="player player2">
                <div class="player-avatar" id="player2-avatar"></div>
                <div class="player-name">å°çŒ´å­2å·</div>
                <div class="player-score" id="player2-score">0</div>
                <div>é‡‘å¸</div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¿¡æ¯ -->
        <div class="game-info">
            <h1>ğŸŒ² å°çŒ´å­æ‰¾æ°´æœ ğŸŒ²</h1>
        </div>
        

        
        <!-- éš¾åº¦é€‰æ‹© -->
        <div class="difficulty-selector">
            <div class="difficulty-buttons">
                <button class="difficulty-btn active" data-rounds="6">6è½®</button>
                <button class="difficulty-btn" data-rounds="7">7è½®</button>
                <button class="difficulty-btn" data-rounds="8">8è½®</button>
                <button class="difficulty-btn" data-rounds="9">9è½®</button>
                <button class="difficulty-btn" data-rounds="10">10è½®</button>
            </div>
        </div>
        
        <!-- æ¸¸æˆçŠ¶æ€ -->
        <div class="game-status" id="game-status">å°çŒ´å­1å·ï¼Œè½®åˆ°ä½ æ‰¾æ°´æœå•¦ï¼</div>
        
        <!-- æ°”çƒå®¹å™¨ -->
        <div id="balloons-container"></div>
    </div>
    
    <!-- å¤´åƒé€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="avatar-modal">
        <div class="modal-content">
            <h2 class="modal-title" id="avatar-modal-title">é€‰æ‹©ä½ çš„çŒ´å­å¤´åƒ</h2>
            <p class="modal-text" id="avatar-modal-text">å°çŒ´å­1å·ï¼Œè¯·é€‰æ‹©ä½ çš„å¤´åƒï¼š</p>
            <div class="avatar-selection">
                <div class="avatar-option" data-avatar="monkey1.jpg" style="background-image: url('monkey1.jpg');"></div>
                <div class="avatar-option" data-avatar="monkey2.jpg" style="background-image: url('monkey2.jpg');"></div>
                <div class="avatar-option" data-avatar="monkey3.jpg" style="background-image: url('monkey3.jpg');"></div>
                <div class="avatar-option" data-avatar="monkey4.jpg" style="background-image: url('monkey4.jpg');"></div>
            </div>
            <button class="continue-btn" id="avatar-confirm-btn" disabled>ç¡®è®¤é€‰æ‹©</button>
        </div>
    </div>
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="victory-music" preload="auto">
        <source src="victory.mp3" type="audio/mpeg">
    </audio>
    
    <!-- ç»“æœæ¨¡æ€æ¡† -->
    <div class="modal hide" id="result-modal">
        <div class="modal-content">
            <div id="winner-avatar" class="winner-avatar"></div>
            <h2 class="modal-title" id="result-title">æ¸¸æˆç»“æŸ</h2>
            <p class="modal-text" id="result-text"></p>
            <button class="continue-btn" id="view-records">å¯»å®è¯¦æƒ…</button>
        </div>
    </div>
    
    <!-- å¯»å®è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal hide" id="records-modal">
        <div class="modal-content">
            <h2 class="modal-title">å¯»å®è¯¦æƒ…</h2>
            <div class="battle-records-list" id="battle-records-list"></div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="continue-btn" id="play-again-from-records">å†æ¥ä¸€å±€</button>
                <button class="continue-btn" id="end-game">ç»“æŸæ¸¸æˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨ªå±æç¤º -->
    <div id="orientation-hint" class="orientation-hint">
        <div class="orientation-content">
            <div class="orientation-icon">ğŸ“±</div>
            <div class="orientation-text">ä¸ºè·å¾—æœ€ä½³ä½“éªŒï¼Œè¯·å°†æ‰‹æœºæ¨ªå±ä½¿ç”¨</div>
            <div class="orientation-subtext">Rotate your device to landscape mode for the best experience</div>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆæ•°æ®
        const fruits = [
            { emoji: 'ğŸ', value: 1000, name: 'è‹¹æœ', level: 1 },
            { emoji: 'ğŸŠ', value: 2000, name: 'æ©™å­', level: 2 },
            { emoji: 'ğŸŒ', value: 3000, name: 'é¦™è•‰', level: 3 },
            { emoji: 'ğŸ‡', value: 4000, name: 'è‘¡è„', level: 4 },
            { emoji: 'ğŸ“', value: 5000, name: 'è‰è“', level: 5 },
            { emoji: 'ğŸ‰', value: 6000, name: 'è¥¿ç“œ', level: 6 },
            { emoji: 'ğŸ', value: 7000, name: 'è è', level: 7 },
            { emoji: 'ğŸ¥­', value: 8000, name: 'èŠ’æœ', level: 8 },
            { emoji: 'ğŸ¥¥', value: 9000, name: 'æ¤°å­', level: 9 },
            { emoji: 'ğŸ¥', value: 10000, name: 'çŒ•çŒ´æ¡ƒ', level: 10 }
        ];
        
        // ä¸åŒé¢œè‰²çš„æ ‡å¿—emoji
        const coloredBalloons = ['ğŸˆ', 'ğŸˆ', 'ğŸˆ']; // æ°”çƒemojiï¼ˆé»˜è®¤å½©è‰²ï¼Œä½†æˆ‘ä»¬ä¼šä½¿ç”¨ä¸åŒç±»å‹çš„æ°”çƒï¼‰
        const coloredFlags = ['ğŸš©', 'ğŸ', 'ğŸŒ']; // ä¸åŒç±»å‹çš„æ——å­emoji
        const multiColorBalloons = ['ğŸ”´', 'ğŸ”µ', 'ğŸŸ£']; // å½©è‰²åœ†å½¢emojiä»£æ›¿æ°”çƒ
        const colors = ['red', 'blue', 'purple'];
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            balloons: [],
            player1Score: 0,
            player2Score: 0,
            currentPlayer: 1,
            round: 1,
            maxRounds: 6, // é»˜è®¤æ¸¸æˆæ€»è½®æ•°
            selectedFruits: 0,
            maxSelectedFruitsPerRound: 2,
            balloonsPerRound: 10, // æ¯è½®å›ºå®šå‡ºç°10ä¸ªå¾…é€‰æ°´æœ
            player1Avatar: '',
            player2Avatar: '',
            currentAvatarSelector: 1, // å½“å‰æ­£åœ¨é€‰æ‹©å¤´åƒçš„ç©å®¶
            roundRecords: [] // ä¿å­˜æ¯è½®è®°å½•
        };
        
        // å¤´åƒé€‰æ‹©çŠ¶æ€
        let selectedAvatar = '';
        
        // è·å–æ¸¸æˆå®¹å™¨å°ºå¯¸
        function getContainerSize() {
            const container = document.querySelector('.game-container');
            return {
                width: container.clientWidth,
                height: container.clientHeight
            };
        }
        
        // ç”Ÿæˆéšæœºä½ç½®
        function getRandomPosition() {
            const size = getContainerSize();
            // å¢åŠ marginå€¼ï¼Œç¡®ä¿æ°”çƒï¼ˆåŒ…æ‹¬æ‚¬åœæ”¾å¤§æ•ˆæœï¼‰å®Œå…¨åœ¨å±å¹•å†…
            const margin = 80;
            // é¡¶éƒ¨ä¿ç•™300pxç©ºé—´ç»™æ–‡å­—åŒºåŸŸï¼Œç¡®ä¿æ°”çƒä¸ä¼šè¢«é®æŒ¡
            const topMargin = 300;
            // åº•éƒ¨ä¿ç•™100pxç©ºé—´ï¼Œç¡®ä¿æ°”çƒä¸ä¼šè¶…å‡ºå±å¹•ä¸‹æ–¹è¾¹ç¼˜
            const bottomMargin = 100;
            
            // ç¡®ä¿ç”Ÿæˆçš„ä½ç½®åœ¨å®¹å™¨èŒƒå›´å†…ï¼Œè€ƒè™‘æ‰€æœ‰è¾¹è·
            return {
                x: Math.random() * (size.width - margin * 2) + margin,
                y: Math.random() * (size.height - topMargin - bottomMargin - margin) + topMargin
            };
        }
        
        // åˆå§‹åŒ–æ°”çƒ
        function initBalloons() {
            const balloons = [];
            
            // æ ¹æ®é€‰æ‹©çš„éš¾åº¦åˆ›å»ºå¯¹åº”æ•°é‡çš„æ°”çƒ
            for (let i = 0; i < gameState.balloonsPerRound; i++) {
                // éšæœºé€‰æ‹©ä¸€ä¸ªæ°´æœ
                const fruitIndex = Math.floor(Math.random() * fruits.length);
                const fruit = fruits[fruitIndex];
                
                // éšæœºä½ç½®
                const position = getRandomPosition();
                
                balloons.push({
                    id: i,
                    fruit: fruit,
                    position: position,
                    clicked: false
                });
            }
            
            return balloons;
        }
        
        // æ¸²æŸ“æ°”çƒ
        function renderBalloons() {
            const container = document.getElementById('balloons-container');
            container.innerHTML = '';
            
            // ä¸åŒé¢œè‰²çš„æ°”çƒ
            const coloredBalloons = ['ğŸ”´', 'ğŸ”µ', 'ğŸŸ£']; // çº¢è‰²ã€è“è‰²ã€ç´«è‰²åœ†å½¢ä»£è¡¨æ°”çƒ
            
            gameState.balloons.forEach((balloon, index) => {
                const balloonElement = document.createElement('div');
                
                // éšæœºé€‰æ‹©é¢œè‰²ç´¢å¼•
                let colorIndex;
                if (index < 3) {
                    // å‰ä¸‰ä¸ªæ°”çƒå›ºå®šä½¿ç”¨ä¸åŒé¢œè‰²
                    colorIndex = index;
                } else {
                    // å‰©ä½™æ°”çƒéšæœºé€‰æ‹©é¢œè‰²
                    colorIndex = Math.floor(Math.random() * 3);
                }
                
                // è®¾ç½®æ°”çƒæ ·å¼
                balloonElement.className = 'balloon';
                balloonElement.textContent = coloredBalloons[colorIndex];
                
                balloonElement.style.fontSize = '2rem';
                balloonElement.style.position = 'absolute';
                balloonElement.style.left = `${balloon.position.x}px`;
                balloonElement.style.top = `${balloon.position.y}px`;
                balloonElement.style.cursor = 'pointer';
                balloonElement.style.transition = 'all 0.3s ease';
                balloonElement.style.zIndex = '50';
                balloonElement.style.animation = 'float 3s ease-in-out infinite';
                balloonElement.dataset.balloonId = balloon.id;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                balloonElement.addEventListener('click', () => handleBalloonClick(balloon.id));
                
                container.appendChild(balloonElement);
            });
        }
        
        // æ¯è½®è®°å½•
        let currentRoundRecord = {
            round: 1,
            player1Fruit: null,
            player2Fruit: null
        };
        
        // å¤„ç†æ°”çƒç‚¹å‡»
        function handleBalloonClick(balloonId) {
            const balloon = gameState.balloons.find(b => b.id === balloonId);
            if (!balloon || balloon.clicked) return;
            
            // æ ‡è®°ä¸ºå·²ç‚¹å‡»
            balloon.clicked = true;
            
            // ç§»é™¤æ°”çƒ
            const balloonElement = document.querySelector(`[data-balloon-id="${balloonId}"]`);
            if (balloonElement) {
                balloonElement.remove();
            }
            
            // æ˜¾ç¤ºæ°´æœ
            showFruit(balloon);
            
            // ä¿å­˜å½“å‰ç©å®¶æ‰¾åˆ°çš„æ°´æœ
            if (gameState.currentPlayer === 1) {
                gameState.player1Score += balloon.fruit.value;
                currentRoundRecord.player1Fruit = balloon.fruit;
            } else {
                gameState.player2Score += balloon.fruit.value;
                currentRoundRecord.player2Fruit = balloon.fruit;
            }
            
            // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateScore();
            
            // å¢åŠ é€‰ä¸­æ°´æœè®¡æ•°
            gameState.selectedFruits++;
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆæœ¬è½®
            if (gameState.selectedFruits >= gameState.maxSelectedFruitsPerRound) {
                // ä¿å­˜æœ¬è½®è®°å½•
                currentRoundRecord.round = gameState.round;
                gameState.roundRecords.push(JSON.parse(JSON.stringify(currentRoundRecord)));
                
                // å»¶è¿Ÿåè¿›å…¥ä¸‹ä¸€è½®
                setTimeout(() => {
                    nextRound();
                }, 1500);
            } else {
                // åˆ‡æ¢ç©å®¶
                gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
                updateGameStatus();
            }
        }
        
        // æ˜¾ç¤ºæ°´æœ
        function showFruit(balloon) {
            const container = document.getElementById('balloons-container');
            
            // åˆ›å»ºæ°´æœå…ƒç´ 
            const fruitElement = document.createElement('div');
            fruitElement.className = 'fruit';
            fruitElement.textContent = balloon.fruit.emoji;
            fruitElement.style.left = `${balloon.position.x}px`;
            fruitElement.style.top = `${balloon.position.y}px`;
            
            // åˆ›å»ºä»·å€¼æ˜¾ç¤º
            const valueElement = document.createElement('div');
            valueElement.className = 'fruit-value';
            valueElement.textContent = `+${balloon.fruit.value}é‡‘å¸`;
            valueElement.style.left = `${balloon.position.x + 20}px`;
            valueElement.style.top = `${balloon.position.y - 20}px`;
            
            container.appendChild(fruitElement);
            container.appendChild(valueElement);
            
            // 3ç§’åç§»é™¤æ°´æœå’Œä»·å€¼
            setTimeout(() => {
                if (fruitElement.parentNode) {
                    fruitElement.remove();
                }
                if (valueElement.parentNode) {
                    valueElement.remove();
                }
            }, 2000);
        }
        
        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            document.getElementById('player1-score').textContent = gameState.player1Score;
            document.getElementById('player2-score').textContent = gameState.player2Score;
        }
        
        // æ›´æ–°æ¸¸æˆçŠ¶æ€æ–‡æœ¬
        function updateGameStatus() {
            const status = document.getElementById('game-status');
            const playerName = gameState.currentPlayer === 1 ? 'å°çŒ´å­1å·' : 'å°çŒ´å­2å·';
            status.textContent = `(${gameState.round}/${gameState.maxRounds}) ${playerName}ï¼Œè½®åˆ°ä½ æ‰¾æ°´æœå•¦ï¼`;
        }
        
        // è¿›å…¥ä¸‹ä¸€è½®
        function nextRound() {
            // æ¸…é™¤æ‰€æœ‰æ ‡å¿—å’Œæ°´æœ
            document.getElementById('balloons-container').innerHTML = '';
            
            // é‡ç½®é€‰ä¸­æ°´æœè®¡æ•°
            gameState.selectedFruits = 0;
            
            // é‡ç½®æ¯è½®è®°å½•
            currentRoundRecord = {
                round: gameState.round + 1,
                player1Fruit: null,
                player2Fruit: null
            };
            
            // æ›´æ–°è½®æ¬¡
            gameState.round++;
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.round > gameState.maxRounds) {
                endGame();
                return;
            }
            
            // ç¡®å®šä¸‹ä¸€è½®çš„å…ˆæ‰‹ç©å®¶ï¼šä¸Šè½®ä»·å€¼ä½çš„ç©å®¶å…ˆé€‰
            if (gameState.round >= 2) { // ä»ç¬¬äºŒè½®å¼€å§‹ï¼ˆå› ä¸ºroundå·²ç»+1ï¼Œæ­¤æ—¶æ˜¯ç¬¬2è½®ï¼‰
                // è·å–ä¸Šä¸€è½®è®°å½•
                const lastRoundRecord = gameState.roundRecords[gameState.roundRecords.length - 1];
                if (lastRoundRecord) {
                    const player1Value = lastRoundRecord.player1Fruit.value;
                    const player2Value = lastRoundRecord.player2Fruit.value;
                    
                    // ä»·å€¼ä½çš„ç©å®¶å…ˆé€‰ï¼Œå¦‚æœä»·å€¼ç›¸åŒåˆ™éšæœºé€‰æ‹©
                    if (player1Value > player2Value) {
                        gameState.currentPlayer = 2;
                    } else if (player2Value > player1Value) {
                        gameState.currentPlayer = 1;
                    } else {
                        // ä»·å€¼ç›¸åŒæ—¶éšæœºé€‰æ‹©
                        gameState.currentPlayer = Math.random() < 0.5 ? 1 : 2;
                    }
                }
            }
            
            // é‡æ–°ç”Ÿæˆæ ‡å¿—
            gameState.balloons = initBalloons();
            
            // æ¸²æŸ“æ–°æ ‡å¿—
            renderBalloons();
            
            // æ›´æ–°ç•Œé¢
            updateGameStatus();
        }
        

        

        
        // åˆå§‹åŒ–AudioContext - ç”¨äºå¤„ç†éŸ³æ•ˆ
        let audioContext = null;
        let audioInitialized = false;
        
        // æ¿€æ´»AudioContext - å¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾æ”¿ç­–
        function activateAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // æ¢å¤AudioContextï¼ˆå¦‚æœè¢«æŒ‚èµ·ï¼‰
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('AudioContextå·²æ¢å¤');
                }).catch(error => {
                    console.log('æ¢å¤AudioContextå¤±è´¥:', error);
                });
            }
            audioInitialized = true;
        }
        
        // ç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡åœ¨ç”¨æˆ·äº¤äº’æ—¶æ¿€æ´»
        function ensureAudioInitialized() {
            if (!audioInitialized) {
                activateAudioContext();
            }
        }
        
        // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡äº¤äº’æ—¶æ¿€æ´»
        document.addEventListener('click', ensureAudioInitialized, { once: true });
        document.addEventListener('touchstart', ensureAudioInitialized, { once: true });
        document.addEventListener('keydown', ensureAudioInitialized, { once: true });
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            const modal = document.getElementById('result-modal');
            const title = document.getElementById('result-title');
            const text = document.getElementById('result-text');
            const winnerAvatar = document.getElementById('winner-avatar');
            
            let winner = '';
            if (gameState.player1Score > gameState.player2Score) {
                winner = 'å°çŒ´å­1å·';
                title.textContent = `ğŸ‰ ${winner}è·èƒœï¼`;
                winnerAvatar.style.backgroundImage = `url('${gameState.player1Avatar}')`;
            } else if (gameState.player1Score < gameState.player2Score) {
                winner = 'å°çŒ´å­2å·';
                title.textContent = `ğŸ‰ ${winner}è·èƒœï¼`;
                winnerAvatar.style.backgroundImage = `url('${gameState.player2Avatar}')`;
            } else {
                title.textContent = 'ğŸ¤ å¹³å±€ï¼';
                winnerAvatar.style.backgroundImage = `url('${gameState.player1Avatar}')`;
            }
            
            text.textContent = `å°çŒ´å­1å·: ${gameState.player1Score} é‡‘å¸ | å°çŒ´å­2å·: ${gameState.player2Score} é‡‘å¸`;
            modal.classList.remove('hide');
            
            // æ¿€æ´»éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿éŸ³é¢‘å¯ä»¥æ’­æ”¾
            activateAudioContext();
            
            // æ’­æ”¾èƒœåˆ©éŸ³ä¹ - ä¿®å¤å¹³æ¿å’Œæ‰‹æœºä¸Šçš„éŸ³é¢‘æ’­æ”¾é—®é¢˜
            playVictoryMusic();
        }
        
        // æ’­æ”¾èƒœåˆ©éŸ³ä¹çš„ç‹¬ç«‹å‡½æ•°
        function playVictoryMusic() {
            try {
                console.log('å°è¯•æ’­æ”¾èƒœåˆ©éŸ³ä¹');
                
                // é¦–å…ˆç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡å·²æ¿€æ´»
                activateAudioContext();
                
                // ç«‹å³æ’­æ”¾ä¸€ä¸ªæçŸ­çš„é™éŸ³ï¼Œç”¨äºæ¿€æ´»éŸ³é¢‘ç®¡é“
                if (audioContext) {
                    console.log('æ’­æ”¾é™éŸ³æ¿€æ´»éŸ³é¢‘ç®¡é“');
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    gainNode.gain.value = 0;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.01);
                }
                
                // æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨HTMLä¸­çš„audioå…ƒç´ ï¼ˆæœ€ä¼˜å…ˆï¼‰
                const victoryAudio = document.getElementById('victory-music');
                if (victoryAudio) {
                    console.log('ä½¿ç”¨HTML audioå…ƒç´ æ’­æ”¾');
                    victoryAudio.currentTime = 0;
                    victoryAudio.volume = 0.5;
                    
                    // å¼ºåˆ¶é‡æ–°åŠ è½½éŸ³é¢‘ï¼Œç¡®ä¿åœ¨å¹³æ¿ä¸Šèƒ½æ­£ç¡®åŠ è½½
                    victoryAudio.load();
                    
                    // æ·»åŠ canplayäº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿éŸ³é¢‘å¯ä»¥æ’­æ”¾æ—¶ç«‹å³å°è¯•
                    victoryAudio.addEventListener('canplay', () => {
                        console.log('éŸ³é¢‘å¯ä»¥æ’­æ”¾äº†ï¼Œå°è¯•æ’­æ”¾');
                        victoryAudio.play().then(() => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆHTMLå…ƒç´ ï¼Œcanplayï¼‰');
                        }).catch(error => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆHTMLå…ƒç´ ï¼Œcanplayï¼‰:', error);
                            tryMethod2();
                        });
                    }, { once: true });
                    
                    // ç«‹å³å°è¯•æ’­æ”¾ï¼Œä¸ç®¡æ˜¯å¦å‡†å¤‡å¥½
                    victoryAudio.play().then(() => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆHTMLå…ƒç´ ï¼Œç«‹å³ï¼‰');
                    }).catch(error => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆHTMLå…ƒç´ ï¼Œç«‹å³ï¼‰:', error);
                        // ä¸ç«‹å³å°è¯•ä¸‹ä¸€ç§æ–¹æ³•ï¼Œç­‰å¾…canplayäº‹ä»¶
                    });
                } else {
                    tryMethod2();
                }
            } catch (error) {
                console.log('æ’­æ”¾èƒœåˆ©éŸ³ä¹æ—¶å‡ºé”™:', error);
                tryMethod2();
            }
            
            function tryMethod2() {
                // æ–¹æ³•2ï¼šä½¿ç”¨Audioå¯¹è±¡ï¼Œæ·»åŠ ç¼“å­˜æ§åˆ¶
                try {
                    console.log('ä½¿ç”¨Audioå¯¹è±¡æ’­æ”¾');
                    // æ·»åŠ éšæœºå‚æ•°ï¼Œé˜²æ­¢ç¼“å­˜é—®é¢˜
                    const victoryMusic = new Audio('victory.mp3?' + Date.now());
                    victoryMusic.volume = 0.5;
                    victoryMusic.crossOrigin = 'anonymous';
                    
                    // ç›‘å¬loadedmetadataäº‹ä»¶
                    victoryMusic.addEventListener('loadedmetadata', () => {
                        console.log('Audioå¯¹è±¡åŠ è½½äº†å…ƒæ•°æ®');
                        victoryMusic.play().then(() => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆAudioå¯¹è±¡ï¼Œloadedmetadataï¼‰');
                        }).catch(backupError => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆAudioå¯¹è±¡ï¼Œloadedmetadataï¼‰:', backupError);
                            tryMethod3();
                        });
                    });
                    
                    // ç›‘å¬canplayäº‹ä»¶
                    victoryMusic.addEventListener('canplay', () => {
                        console.log('Audioå¯¹è±¡å¯ä»¥æ’­æ”¾äº†');
                        victoryMusic.play().then(() => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆAudioå¯¹è±¡ï¼Œcanplayï¼‰');
                        }).catch(backupError => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆAudioå¯¹è±¡ï¼Œcanplayï¼‰:', backupError);
                            tryMethod3();
                        });
                    });
                    
                    // ç«‹å³å°è¯•æ’­æ”¾
                    victoryMusic.play().then(() => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆAudioå¯¹è±¡ï¼Œç«‹å³ï¼‰');
                    }).catch(backupError => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆAudioå¯¹è±¡ï¼Œç«‹å³ï¼‰:', backupError);
                        // ç­‰å¾…äº‹ä»¶è§¦å‘
                    });
                } catch (error) {
                    console.log('Audioå¯¹è±¡æ’­æ”¾å¤±è´¥:', error);
                    tryMethod3();
                }
            }
            
            function tryMethod3() {
                // æ–¹æ³•3ï¼šä½¿ç”¨AudioContextç›´æ¥æ’­æ”¾ï¼Œæ·»åŠ æ›´å¯é çš„fetch
                try {
                    if (audioContext) {
                        console.log('å°è¯•ä½¿ç”¨AudioContextæ’­æ”¾èƒœåˆ©éŸ³ä¹');
                        // æ·»åŠ éšæœºå‚æ•°ï¼Œé˜²æ­¢ç¼“å­˜é—®é¢˜
                        fetch('victory.mp3?' + Date.now(), {
                            cache: 'reload',
                            mode: 'cors'
                        })
                        .then(response => {
                            console.log('fetchå“åº”çŠ¶æ€:', response.status);
                            if (!response.ok) {
                                throw new Error(`HTTPé”™è¯¯ï¼çŠ¶æ€: ${response.status}`);
                            }
                            return response.arrayBuffer();
                        })
                        .then(arrayBuffer => {
                            console.log('è·å–åˆ°éŸ³é¢‘æ•°æ®ï¼Œå¤§å°:', arrayBuffer.byteLength);
                            return audioContext.decodeAudioData(arrayBuffer);
                        })
                        .then(audioBuffer => {
                            console.log('è§£ç éŸ³é¢‘æˆåŠŸï¼Œæ—¶é•¿:', audioBuffer.duration);
                            const source = audioContext.createBufferSource();
                            source.buffer = audioBuffer;
                            
                            // æ·»åŠ éŸ³é‡æ§åˆ¶
                            const gainNode = audioContext.createGain();
                            gainNode.gain.value = 0.5;
                            
                            source.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            source.start();
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆAudioContextï¼‰');
                        })
                        .catch(contextError => {
                            console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆAudioContextï¼‰:', contextError);
                            console.log('æ‰€æœ‰éŸ³é¢‘æ’­æ”¾æ–¹æ³•å‡å¤±è´¥');
                            // å°è¯•æœ€åŸå§‹çš„æ–¹æ³•
                            tryFallbackMethod();
                        });
                    } else {
                        console.log('AudioContextæœªåˆå§‹åŒ–');
                        tryFallbackMethod();
                    }
                } catch (error) {
                    console.log('AudioContextæ’­æ”¾å¤±è´¥:', error);
                    tryFallbackMethod();
                }
            }
            
            // æœ€åçš„å¤‡é€‰æ–¹æ¡ˆï¼šç›´æ¥åˆ›å»ºæ–°çš„éŸ³é¢‘å…ƒç´ å¹¶æ’­æ”¾
            function tryFallbackMethod() {
                try {
                    console.log('å°è¯•æœ€åçš„å¤‡é€‰æ–¹æ¡ˆï¼šåˆ›å»ºæ–°çš„éŸ³é¢‘å…ƒç´ ');
                    const newAudio = document.createElement('audio');
                    newAudio.src = 'victory.mp3?' + Date.now();
                    newAudio.volume = 0.5;
                    newAudio.autoplay = true;
                    newAudio.setAttribute('preload', 'auto');
                    
                    // å°†éŸ³é¢‘å…ƒç´ æ·»åŠ åˆ°DOMä¸­
                    document.body.appendChild(newAudio);
                    
                    newAudio.play().then(() => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾æˆåŠŸï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰');
                        // æ’­æ”¾å®Œæˆåç§»é™¤å…ƒç´ 
                        newAudio.addEventListener('ended', () => {
                            newAudio.remove();
                        });
                    }).catch(error => {
                        console.log('èƒœåˆ©éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰:', error);
                        newAudio.remove();
                        console.log('æ‰€æœ‰éŸ³é¢‘æ’­æ”¾æ–¹æ³•å‡å¤±è´¥');
                    });
                } catch (error) {
                    console.log('å¤‡é€‰æ–¹æ¡ˆæ’­æ”¾å¤±è´¥:', error);
                }
            }
        }
        
        // æ›´æ–°ç©å®¶å¤´åƒæ˜¾ç¤º
        function updatePlayerAvatars() {
            // ç¡®ä¿å¤´åƒURLè¢«æ­£ç¡®è®¾ç½®ä¸ºèƒŒæ™¯å›¾ç‰‡
            const player1Avatar = document.getElementById('player1-avatar');
            const player2Avatar = document.getElementById('player2-avatar');
            
            // è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„url()æ ¼å¼
            if (gameState.player1Avatar) {
                player1Avatar.style.backgroundImage = `url('${gameState.player1Avatar}')`;
            } else {
                player1Avatar.style.backgroundImage = '';
            }
            
            if (gameState.player2Avatar) {
                player2Avatar.style.backgroundImage = `url('${gameState.player2Avatar}')`;
            } else {
                player2Avatar.style.backgroundImage = '';
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            console.log('å¼€å§‹æ¸¸æˆï¼Œå½“å‰gameState:', gameState);
            
            // åˆå§‹åŒ–æ¸¸æˆæ¿
            gameState.balloons = initBalloons();
            
            // æ›´æ–°ç•Œé¢
            updateScore();
            updateGameStatus();
            
            // æ¸²æŸ“æ°”çƒ
            renderBalloons();
            
            // æ›´æ–°ç©å®¶å¤´åƒ
            updatePlayerAvatars();
            
            console.log('æ¸¸æˆå¼€å§‹å®Œæˆï¼Œæ°”çƒæ•°é‡:', gameState.balloons.length);
        }
        
        // æ–°æ¸¸æˆ
        function newGame() {
            // éšæœºé€‰æ‹©èƒŒæ™¯å›¾
            const backgroundImages = ['forest1.jpg', 'forest2.jpg'];
            const randomBackground = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
            const forestBackground = document.querySelector('.forest-background');
            forestBackground.style.backgroundImage = `url('${randomBackground}')`;
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                balloons: [],
                player1Score: 0,
                player2Score: 0,
                currentPlayer: Math.random() < 0.5 ? 1 : 2, // éšæœºé€‰æ‹©ç¬¬ä¸€ä¸ªç©å®¶
                round: 1,
                maxRounds: parseInt(document.querySelector('.difficulty-btn.active').dataset.rounds),
                selectedFruits: 0,
                maxSelectedFruitsPerRound: 2,
                balloonsPerRound: 10, // æ¯è½®å›ºå®šå‡ºç°10ä¸ªå¾…é€‰æ°´æœ
                player1Avatar: 'monkey1.jpg', // é»˜è®¤å¤´åƒ
                player2Avatar: 'monkey2.jpg', // é»˜è®¤å¤´åƒ
                currentAvatarSelector: 1,
                roundRecords: [] // é‡ç½®è½®æ¬¡è®°å½•
            };
            
            // é‡ç½®å½“å‰è½®æ¬¡è®°å½•
            currentRoundRecord = {
                round: 1,
                player1Fruit: null,
                player2Fruit: null
            };
            
            // é‡ç½®ç•Œé¢
            document.getElementById('result-modal').classList.add('hide');
            
            // æ˜¾ç¤ºå¤´åƒé€‰æ‹©æ¨¡æ€æ¡†
            showAvatarSelection();
        }
        
        // æ˜¾ç¤ºå¤´åƒé€‰æ‹©
        function showAvatarSelection() {
            const modal = document.getElementById('avatar-modal');
            const text = document.getElementById('avatar-modal-text');
            const confirmBtn = document.getElementById('avatar-confirm-btn');
            
            // æ›´æ–°æ¨¡æ€æ¡†æ–‡æœ¬
            text.textContent = gameState.currentAvatarSelector === 1 ? 'å°çŒ´å­1å·ï¼Œè¯·é€‰æ‹©ä½ çš„å¤´åƒï¼š' : 'å°çŒ´å­2å·ï¼Œè¯·é€‰æ‹©ä½ çš„å¤´åƒï¼š';
            
            // é‡ç½®é€‰æ‹©
            selectedAvatar = '';
            confirmBtn.disabled = true;
            
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.classList.remove('hide');
        }
        
        // å¤„ç†å¤´åƒé€‰æ‹©
        function handleAvatarSelect(avatar) {
            selectedAvatar = avatar;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.avatar === avatar) {
                    option.classList.add('selected');
                }
            });
            
            // å¯ç”¨ç¡®è®¤æŒ‰é’®
            document.getElementById('avatar-confirm-btn').disabled = false;
        }
        
        // ç¡®è®¤å¤´åƒé€‰æ‹©
        function confirmAvatarSelection() {
            if (!selectedAvatar) return;
            
            // ä¿å­˜é€‰æ‹©çš„å¤´åƒ
            if (gameState.currentAvatarSelector === 1) {
                gameState.player1Avatar = selectedAvatar;
                gameState.currentAvatarSelector = 2;
                showAvatarSelection();
            } else {
                gameState.player2Avatar = selectedAvatar;
                
                // éšè—å¤´åƒé€‰æ‹©æ¨¡æ€æ¡†
                document.getElementById('avatar-modal').classList.add('hide');
                
                // å¼€å§‹æ¸¸æˆ
                startGame();
            }
        }
        
        // å¤„ç†éš¾åº¦é€‰æ‹©
        function handleDifficultyChange() {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ä¸ºå½“å‰ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ activeç±»
            this.classList.add('active');
            
            // è·å–æ¸¸æˆæ€»è½®æ•°
            const totalRounds = parseInt(this.dataset.rounds);
            
            // éšæœºé€‰æ‹©èƒŒæ™¯å›¾
            const backgroundImages = ['forest1.jpg', 'forest2.jpg'];
            const randomBackground = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
            const forestBackground = document.querySelector('.forest-background');
            forestBackground.style.backgroundImage = `url('${randomBackground}')`;
            
            // ä¿å­˜å½“å‰å¤´åƒé€‰æ‹©
            const player1Avatar = gameState.player1Avatar;
            const player2Avatar = gameState.player2Avatar;
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä½†ä¿ç•™ç°æœ‰å¤´åƒ
            gameState = {
                balloons: [],
                player1Score: 0,
                player2Score: 0,
                currentPlayer: Math.random() < 0.5 ? 1 : 2, // éšæœºé€‰æ‹©ç¬¬ä¸€ä¸ªç©å®¶
                round: 1,
                maxRounds: totalRounds,
                selectedFruits: 0,
                maxSelectedFruitsPerRound: 2,
                balloonsPerRound: 10, // æ¯è½®å›ºå®šå‡ºç°10ä¸ªå¾…é€‰æ°´æœ
                player1Avatar: player1Avatar, // ä¿ç•™ç°æœ‰å¤´åƒ
                player2Avatar: player2Avatar, // ä¿ç•™ç°æœ‰å¤´åƒ
                currentAvatarSelector: 1,
                roundRecords: [] // é‡ç½®è½®æ¬¡è®°å½•
            };
            
            // é‡ç½®å½“å‰è½®æ¬¡è®°å½•
            currentRoundRecord = {
                round: 1,
                player1Fruit: null,
                player2Fruit: null
            };
            
            // é‡ç½®ç•Œé¢
            document.getElementById('result-modal').classList.add('hide');
            document.getElementById('records-modal').classList.add('hide');
            
            // ç›´æ¥å¼€å§‹æ¸¸æˆï¼Œä¸æ˜¾ç¤ºå¤´åƒé€‰æ‹©
            startGame();
        }
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ°”çƒä½ç½®
        window.addEventListener('resize', () => {
            // é‡æ–°ç”Ÿæˆä½ç½®
            gameState.balloons.forEach(balloon => {
                balloon.position = getRandomPosition();
            });
            renderBalloons();
        });
        

        
        // æ˜¾ç¤ºå¯»å®è¯¦æƒ…
        function showRecords() {
            const modal = document.getElementById('records-modal');
            const recordsList = document.getElementById('battle-records-list');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            recordsList.innerHTML = '';
            
            // æ·»åŠ æ€»é‡‘å¸æ•°æ˜¾ç¤º
            const totalScoresDiv = document.createElement('div');
            totalScoresDiv.style.background = 'rgba(255, 217, 61, 0.2)';
            totalScoresDiv.style.padding = '15px';
            totalScoresDiv.style.borderRadius = '10px';
            totalScoresDiv.style.marginBottom = '20px';
            totalScoresDiv.style.textAlign = 'center';
            totalScoresDiv.innerHTML = `
                <h3 style="margin: 0 0 10px 0; color: #ffd700;">æ€»é‡‘å¸æ•°</h3>
                <div style="display: flex; justify-content: space-around; gap: 20px;">
                    <div style="flex: 1; background: rgba(0, 0, 0, 0.1); padding: 10px; border-radius: 8px;">
                        <div class="player-name" style="color: #ff6b6b;">å°çŒ´å­1å·</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ffd700;">${gameState.player1Score} é‡‘å¸</div>
                    </div>
                    <div style="flex: 1; background: rgba(0, 0, 0, 0.1); padding: 10px; border-radius: 8px;">
                        <div class="player-name" style="color: #4ecdc4;">å°çŒ´å­2å·</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ffd700;">${gameState.player2Score} é‡‘å¸</div>
                    </div>
                </div>
            `;
            recordsList.appendChild(totalScoresDiv);
            
            // ç”Ÿæˆæ¯è½®æˆ˜å†µ
            gameState.roundRecords.forEach((record, index) => {
                const roundRecord = document.createElement('div');
                roundRecord.className = 'round-record';
                
                // è½®æ¬¡æ ‡é¢˜
                const roundTitle = document.createElement('div');
                roundTitle.className = 'round-title';
                roundTitle.textContent = `ç¬¬${record.round}è½®`;
                roundRecord.appendChild(roundTitle);
                
                // æ¯”è¾ƒæœ¬è½®è·èƒœè€…
                const player1Value = record.player1Fruit.value;
                const player2Value = record.player2Fruit.value;
                const player1Wins = player1Value > player2Value;
                const player2Wins = player2Value > player1Value;
                
                // ç©å®¶é€‰æ‹©åŒºåŸŸ
                const selections = document.createElement('div');
                selections.className = 'player-selections';
                
                // ç©å®¶1é€‰æ‹©
                const player1Selection = document.createElement('div');
                player1Selection.className = 'player-selection';
                player1Selection.innerHTML = `
                    <div class="player-name" style="color: #ff6b6b;">
                        å°çŒ´å­1å· ${player1Wins ? 'ğŸ†' : ''}
                    </div>
                    <div class="fruit-info">
                        <div class="fruit-emoji">${record.player1Fruit.emoji}</div>
                        <div class="fruit-details">
                            <div>${record.player1Fruit.name}</div>
                            <div>ä»·å€¼: ${record.player1Fruit.value}é‡‘å¸</div>
                            <div>ç­‰çº§: Lv.${record.player1Fruit.level}</div>
                        </div>
                    </div>
                `;
                selections.appendChild(player1Selection);
                
                // ç©å®¶2é€‰æ‹©
                const player2Selection = document.createElement('div');
                player2Selection.className = 'player-selection';
                player2Selection.innerHTML = `
                    <div class="player-name" style="color: #4ecdc4;">
                        å°çŒ´å­2å· ${player2Wins ? 'ğŸ†' : ''}
                    </div>
                    <div class="fruit-info">
                        <div class="fruit-emoji">${record.player2Fruit.emoji}</div>
                        <div class="fruit-details">
                            <div>${record.player2Fruit.name}</div>
                            <div>ä»·å€¼: ${record.player2Fruit.value}é‡‘å¸</div>
                            <div>ç­‰çº§: Lv.${record.player2Fruit.level}</div>
                        </div>
                    </div>
                `;
                selections.appendChild(player2Selection);
                
                roundRecord.appendChild(selections);
                recordsList.appendChild(roundRecord);
            });
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.classList.remove('hide');
        }
        
        // äº‹ä»¶ç›‘å¬ - ä¿®å¤æ‰€æœ‰æŒ‰é’®æ— å“åº”é—®é¢˜
        // ç¡®ä¿DOMåŠ è½½å®Œæˆåå†ç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹ç»‘å®šäº‹ä»¶ç›‘å¬å™¨');
            
            // å¯»å®è¯¦æƒ…æŒ‰é’®
            const viewRecordsBtn = document.getElementById('view-records');
            if (viewRecordsBtn) {
                viewRecordsBtn.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†å¯»å®è¯¦æƒ…æŒ‰é’®');
                    showRecords();
                });
            }
            
            // ä»å¯»å®è¯¦æƒ…é‡æ–°å¼€å§‹æ¸¸æˆ
            const playAgainFromRecordsBtn = document.getElementById('play-again-from-records');
            if (playAgainFromRecordsBtn) {
                playAgainFromRecordsBtn.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†å†æ¥ä¸€å±€æŒ‰é’®');
                    const recordsModal = document.getElementById('records-modal');
                    recordsModal.classList.add('hide');
                    newGame();
                });
            }
            
            // ç»“æŸæ¸¸æˆ
            const endGameBtn = document.getElementById('end-game');
            if (endGameBtn) {
                endGameBtn.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†ç»“æŸæ¸¸æˆæŒ‰é’®');
                    const recordsModal = document.getElementById('records-modal');
                    recordsModal.classList.add('hide');
                    const resultModal = document.getElementById('result-modal');
                    resultModal.classList.add('hide');
                });
            }
            
            // å¤´åƒç¡®è®¤æŒ‰é’®
            const avatarConfirmBtn = document.getElementById('avatar-confirm-btn');
            if (avatarConfirmBtn) {
                avatarConfirmBtn.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†å¤´åƒç¡®è®¤æŒ‰é’®');
                    confirmAvatarSelection();
                });
            }
            
            // éš¾åº¦é€‰æ‹©æŒ‰é’®
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†éš¾åº¦é€‰æ‹©æŒ‰é’®:', btn.textContent);
                    handleDifficultyChange.call(btn);
                });
            });
            
            // å¤´åƒé€‰æ‹©
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', () => {
                    console.log('ç‚¹å‡»äº†å¤´åƒé€‰é¡¹:', option.dataset.avatar);
                    handleAvatarSelect(option.dataset.avatar);
                });
            });
        });
        

        

        
        // é’ˆå¯¹iOSè®¾å¤‡çš„æ¨ªå±æ£€æµ‹å’Œæç¤ºå¢å¼º
        function checkOrientation() {
            const isMobile = window.innerWidth < 1024;
            const isPortrait = window.innerWidth < window.innerHeight;
            const hint = document.getElementById('orientation-hint');
            
            // é’ˆå¯¹iOSè®¾å¤‡çš„ç‰¹æ®Šå¤„ç†
            if (isMobile && isPortrait) {
                hint.style.display = 'flex';
            } else {
                hint.style.display = 'none';
            }
        }
        
        // åˆå§‹åŒ–æ¨ªå±æ£€æµ‹
        checkOrientation();
        
        // ç›‘å¬å±å¹•æ—‹è½¬å’Œå°ºå¯¸å˜åŒ–
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
        
        // åˆå§‹åŒ–èƒŒæ™¯å›¾
        const backgroundImages = ['forest1.jpg', 'forest2.jpg'];
        const randomBackground = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
        const forestBackground = document.querySelector('.forest-background');
        forestBackground.style.backgroundImage = `url('${randomBackground}')`;
        
        // åˆå§‹åŒ–æ¸¸æˆï¼Œæ˜¾ç¤ºå¤´åƒé€‰æ‹©
        showAvatarSelection();
    </script>
</body>
</html>
