<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£æœºå¤§ä½œæˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .player-info {
            display: flex;
            gap: 30px;
        }
        
        .player {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .score {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .player1 .score {
            color: #ff6b6b;
        }
        
        .player2 .score {
            color: #4ecdc4;
        }
        
        .game-status {
            text-align: center;
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }
        
        /* æ¸¸æˆæ¿æ ·å¼ */
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .column {
            display: grid;
            grid-template-rows: repeat(10, 1fr);
            gap: 10px;
        }
        
        /* é£æœºå¡ç‰‡æ ·å¼ */
        .plane-card {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .plane-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .plane-card.selected {
            border-color: #ffd93d;
            background: rgba(255, 217, 61, 0.3);
        }
        
        .plane-card.revealed {
            background: rgba(78, 205, 196, 0.3);
            cursor: default;
        }
        
        /* é£æœºå›¾æ ‡æ ·å¼ */
        .plane-emoji {
            width: 60px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin: 5px auto;
        }
        
        /* é£æœºemojiæ ·å¼ */
        .plane-emoji {
            font-size: 3rem;
            margin: 10px auto;
        }
        
        /* ä¸åŒç­‰çº§æˆ˜æœºçš„emoji */
        .level-1 .plane-emoji { content: 'ğŸ›©ï¸'; }
        .level-2 .plane-emoji { content: 'âœˆï¸'; }
        .level-3 .plane-emoji { content: 'ğŸš'; }
        .level-4 .plane-emoji { content: 'ğŸ›«'; }
        .level-5 .plane-emoji { content: 'ğŸ›¬'; }
        .level-6 .plane-emoji { content: 'ğŸ§¨'; }
        .level-7 .plane-emoji { content: 'ğŸ’£'; }
        .level-8 .plane-emoji { content: 'ğŸš€'; }
        .level-9 .plane-emoji { content: 'ğŸ›¸'; }
        .level-10 .plane-emoji { content: 'ğŸ‘¾'; }
        
        .plane-health {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .plane-level {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 3px;
        }
        
        /* å¯¹å†³æ¨¡æ€æ¡†æ ·å¼ */
        .battle-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .battle-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 900px;
            width: 95%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .battle-title {
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        .battle-planes {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 40px;
            margin: 30px 0;
        }
        
        .battle-plane {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            min-width: 250px;
        }
        
        .battle-plane-emoji {
            font-size: 5rem;
            margin: 20px auto;
        }
        
        /* ä¸åŒç­‰çº§æˆ˜æœºçš„emoji */
        .level-1.battle-plane-emoji::before { content: 'ğŸ›©ï¸'; }
        .level-2.battle-plane-emoji::before { content: 'âœˆï¸'; }
        .level-3.battle-plane-emoji::before { content: 'ğŸš'; }
        .level-4.battle-plane-emoji::before { content: 'ğŸ›«'; }
        .level-5.battle-plane-emoji::before { content: 'ğŸ›¬'; }
        .level-6.battle-plane-emoji::before { content: 'ğŸ§¨'; }
        .level-7.battle-plane-emoji::before { content: 'ğŸ’£'; }
        .level-8.battle-plane-emoji::before { content: 'ğŸš€'; }
        .level-9.battle-plane-emoji::before { content: 'ğŸ›¸'; }
        .level-10.battle-plane-emoji::before { content: 'ğŸ‘¾'; }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757 0%, #ffa502 50%, #2ed573 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .versus-text {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd93d;
        }
        
        .battle-result {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .continue-btn {
            background: linear-gradient(45deg, #2ed573 0%, #1e90ff 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 213, 115, 0.4);
        }
        
        /* å‡»æ¯åŠ¨ç”»æ•ˆæœ */
        /* å¯¼å¼¹é£è¡ŒåŠ¨ç”» */
        @keyframes missile {
            0% { 
                opacity: 1;
                transform: scale(0.5) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1) rotate(180deg);
            }
            100% { 
                opacity: 0;
                transform: scale(1) rotate(360deg);
            }
        }
        
        /* ç °åœ°ä¸€å£°çˆ†ç‚¸åŠ¨ç”» */
        @keyframes explode {
            0% { 
                transform: scale(1); 
                opacity: 1;
                filter: brightness(1);
                box-shadow: 0 0 0 rgba(255, 71, 87, 0);
            }
            50% { 
                transform: scale(1.2); 
                opacity: 1;
                filter: brightness(3);
                box-shadow: 0 0 40px #ff4757, 0 0 80px #ff4757, 0 0 120px #ff4757, 0 0 160px #ff4757;
            }
            100% { 
                transform: scale(1); 
                opacity: 0;
                filter: brightness(1);
                box-shadow: 0 0 0 rgba(255, 71, 87, 0);
            }
        }
        
        /* é£æœºæ¶ˆå¤±åŠ¨ç”» */
        @keyframes disappear {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0);
            }
        }
        
        /* éœ‡åŠ¨åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        
        /* å¯¼å¼¹æ ·å¼ - æ›´çœŸå®çš„å¯¼å¼¹å¤–è§‚ */
        .missile {
            position: absolute;
            width: 60px;
            height: 12px;
            background: linear-gradient(to right, #333, #666);
            border-radius: 6px 0 0 6px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(255, 217, 61, 0.8);
        }
        
        /* å¯¼å¼¹å¤´éƒ¨ */
        .missile::before {
            content: '';
            position: absolute;
            right: -15px;
            top: 0;
            width: 0;
            height: 0;
            border-left: 15px solid #333;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        
        /* å¯¼å¼¹å°¾ç¿¼ */
        .missile::after {
            content: '';
            position: absolute;
            left: -5px;
            top: -8px;
            width: 10px;
            height: 6px;
            background: #555;
            border-radius: 3px;
            box-shadow: 0 14px 0 #555;
        }
        
        /* å¯¼å¼¹å°¾éƒ¨ç«ç„° */
        .missile-fly::after {
            content: '';
            position: absolute;
            left: -15px;
            top: 2px;
            width: 15px;
            height: 8px;
            background: linear-gradient(to left, #ffd93d, #ff4757);
            border-radius: 50% 0 0 50%;
            animation: missile-flame 0.1s infinite alternate;
        }
        
        /* å¯¼å¼¹ç«ç„°åŠ¨ç”» */
        @keyframes missile-flame {
            0% {
                opacity: 0.8;
                transform: scaleX(1);
            }
            100% {
                opacity: 1;
                transform: scaleX(1.2);
            }
        }
        
        /* å¯¼å¼¹é£è¡Œè·¯å¾„åŠ¨ç”» - ä½¿ç”¨transformå®ç°æŠ›ç‰©çº¿è½¨è¿¹ */
        .missile-fly {
            animation: missile-fly 1s ease-in forwards;
        }
        
        @keyframes missile-fly {
            0% { 
                opacity: 1;
                transform: translateX(0) translateY(0) scale(0.5) rotate(var(--rotation));
            }
            25% {
                opacity: 1;
                transform: translateX(calc(var(--end-x) * 0.25)) translateY(calc(var(--end-y) * 0.25 - 20px)) scale(0.7) rotate(var(--rotation));
            }
            50% {
                opacity: 1;
                transform: translateX(calc(var(--end-x) * 0.5)) translateY(calc(var(--end-y) * 0.5 - 30px)) scale(0.85) rotate(var(--rotation));
            }
            75% {
                opacity: 1;
                transform: translateX(calc(var(--end-x) * 0.75)) translateY(calc(var(--end-y) * 0.75 - 15px)) scale(0.95) rotate(var(--rotation));
            }
            100% { 
                opacity: 0;
                transform: translateX(var(--end-x)) translateY(var(--end-y)) scale(1) rotate(var(--rotation));
            }
        }
        
        /* çˆ†ç‚¸åŠ¨ç”» */
        .plane-explode {
            animation: explode 0.8s ease-out forwards;
        }
        
        /* é£æœºæ¶ˆå¤±åŠ¨ç”» */
        .plane-disappear {
            animation: disappear 0.8s ease-out forwards;
        }
        
        /* éœ‡åŠ¨åŠ¨ç”» */
        .plane-shake {
            animation: shake 0.2s ease-in-out infinite;
        }
        
        /* ç»“æœæ¨¡æ€æ¡†æ ·å¼ */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .result-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>é£æœºå¤§ä½œæˆ˜</h1>
        
        <div class="game-info">
            <div class="player-info">
                <div class="player player1">
                    <div>ç©å®¶1</div>
                    <div class="score" id="player1-score">0</div>
                </div>
                <div class="player player2">
                    <div>ç©å®¶2</div>
                    <div class="score" id="player2-score">0</div>
                </div>
            </div>
            <div class="round-info">
                è½®æ¬¡: <span id="round-count">0</span>
            </div>
        </div>
        
        <div class="game-status" id="game-status">ç©å®¶1ï¼Œè¯·é€‰æ‹©ä½ çš„é£æœº</div>
        
        <!-- 10è¡Œ4åˆ—çš„æ¸¸æˆæ¿ -->
        <div class="game-board" id="game-board"></div>
    </div>
    
    <!-- å¯¹å†³æ¨¡æ€æ¡† -->
    <div class="battle-modal hide" id="battle-modal">
        <div class="battle-content">
            <h2 class="battle-title">ğŸš¨ é£æœºå¯¹å†³ ğŸš¨</h2>
            <div class="battle-planes" style="position: relative;">
                <!-- ç©å®¶1é£æœº -->
                <div class="battle-plane" style="position: relative; z-index: 5;">
                    <div>ç©å®¶1</div>
                    <div id="battle-emoji1" style="font-size: 5rem; margin: 20px auto;"></div>
                    <div id="battle-name1"></div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill1" style="width: 50%"></div>
                    </div>
                    <div id="health-value1"></div>
                </div>
                
                <!-- æ¿€å…‰æŸå®¹å™¨ -->
                <div id="laser-container" style="position: absolute; top: 50%; left: 0; right: 0; height: 4px; pointer-events: none; z-index: 10;"></div>
                
                <div class="versus-text">VS</div>
                
                <!-- ç©å®¶2é£æœº -->
                <div class="battle-plane" style="position: relative; z-index: 5;">
                    <div>ç©å®¶2</div>
                    <div id="battle-emoji2" style="font-size: 5rem; margin: 20px auto;"></div>
                    <div id="battle-name2"></div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill2" style="width: 50%"></div>
                    </div>
                    <div id="health-value2"></div>
                </div>
            </div>
            
            <div class="battle-result" id="battle-result"></div>
            <button class="continue-btn hide" id="continue-btn">ç»§ç»­æ¸¸æˆ</button>
        </div>
    </div>
    
    <!-- ç»“æœæ¨¡æ€æ¡† -->
    <div class="result-modal hide" id="result-modal">
        <div class="result-content">
            <h2 id="result-title">æ¸¸æˆç»“æŸ</h2>
            <p id="result-text"></p>
            <button class="continue-btn" id="play-again">å†æ¥ä¸€å±€</button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆæ•°æ®
        const planes = [
            { emoji: 'ğŸ›©ï¸', health: 10, name: 'è½»å‹æˆ˜æ–—æœº', level: 1 },
            { emoji: 'âœˆï¸', health: 20, name: 'ä¸­å‹æˆ˜æ–—æœº', level: 2 },
            { emoji: 'ğŸš', health: 30, name: 'ç›´å‡æœº', level: 3 },
            { emoji: 'ğŸ›«', health: 40, name: 'èµ·é£å®¢æœº', level: 4 },
            { emoji: 'ğŸ›¬', health: 50, name: 'é™è½å®¢æœº', level: 5 },
            { emoji: 'ğŸ§¨', health: 60, name: 'è½°ç‚¸æœº', level: 6 },
            { emoji: 'ğŸ’£', health: 70, name: 'æ”»å‡»æœº', level: 7 },
            { emoji: 'ğŸš€', health: 80, name: 'ç«ç®­é£æœº', level: 8 },
            { emoji: 'ğŸ›¸', health: 90, name: 'é£ç¢Ÿ', level: 9 },
            { emoji: 'ğŸ‘¾', health: 100, name: 'å¤–æ˜Ÿæˆ˜æœº', level: 10 }
        ];
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            board: [],
            player1Score: 0,
            player2Score: 0,
            currentPlayer: 1,
            selectedPlanes: [],
            roundCount: 0,
            revealedCount: 0,
            totalPlanes: 40
        };
        
        // åˆå§‹åŒ–æ¸¸æˆæ¿
        function initBoard() {
            const board = [];
            
            // åˆ›å»º4åˆ—ï¼Œæ¯åˆ—10è¡Œ
            for (let col = 0; col < 4; col++) {
                const column = [];
                // å¤åˆ¶é£æœºæ•°ç»„å¹¶æ‰“ä¹±
                const shuffledPlanes = [...planes].sort(() => Math.random() - 0.5);
                
                for (let row = 0; row < 10; row++) {
                    column.push({
                        ...shuffledPlanes[row],
                        revealed: false,
                        selected: false
                    });
                }
                board.push(column);
            }
            
            return board;
        }
        
        // æ¸²æŸ“æ¸¸æˆæ¿
        function renderBoard() {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';
            
            gameState.board.forEach((column, colIndex) => {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'column';
                
                column.forEach((plane, rowIndex) => {
                    const card = document.createElement('div');
                    card.className = `plane-card level-${plane.level}`;
                    
                    if (plane.revealed) {
                        card.classList.add('revealed');
                    }
                    
                    if (plane.selected) {
                        card.classList.add('selected');
                    }
                    
                    // å¡ç‰‡å†…å®¹
                    let cardContent = '';
                    if (plane.revealed) {
                        cardContent = `
                            <div class="plane-emoji">${plane.emoji}</div>
                            <div class="plane-health">${plane.health}</div>
                            <div class="plane-level">Lv.${plane.level}</div>
                        `;
                    } else {
                        cardContent = '<div class="plane-emoji">â“</div>';
                    }
                    
                    card.innerHTML = cardContent;
                    card.dataset.col = colIndex;
                    card.dataset.row = rowIndex;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    card.addEventListener('click', () => handleCardClick(colIndex, rowIndex));
                    
                    columnDiv.appendChild(card);
                });
                
                gameBoard.appendChild(columnDiv);
            });
        }
        
        // å¤„ç†å¡ç‰‡ç‚¹å‡»
        function handleCardClick(col, row) {
            const plane = gameState.board[col][row];
            
            // å¦‚æœå¡ç‰‡å·²æ­ç¤ºï¼Œä¸èƒ½å†æ¬¡é€‰æ‹©
            if (plane.revealed) {
                return;
            }
            
            // å¦‚æœå¡ç‰‡å·²è¢«é€‰ä¸­ï¼Œä¸èƒ½å†æ¬¡é€‰æ‹©
            if (plane.selected) {
                return;
            }
            
            // é€‰æ‹©å¡ç‰‡
            plane.selected = true;
            gameState.selectedPlanes.push({ col, row, plane });
            
            // æ›´æ–°ç•Œé¢
            renderBoard();
            
            // å¦‚æœæ˜¯ç©å®¶1é€‰æ‹©ï¼Œåˆ‡æ¢åˆ°ç©å®¶2
            if (gameState.currentPlayer === 1) {
                gameState.currentPlayer = 2;
                document.getElementById('game-status').textContent = 'ç©å®¶2ï¼Œè¯·é€‰æ‹©ä½ çš„é£æœº';
            } else {
                // ä¸¤ä¸ªç©å®¶éƒ½å·²é€‰æ‹©ï¼Œæ˜¾ç¤ºå¯¹å†³ç”»é¢
                setTimeout(() => {
                    showBattleScreen();
                }, 1000);
            }
        }
        
        // æ˜¾ç¤ºå¯¹å†³ç”»é¢
        function showBattleScreen() {
            const [player1, player2] = gameState.selectedPlanes;
            const modal = document.getElementById('battle-modal');
            const continueBtn = document.getElementById('continue-btn');
            const laserContainer = document.getElementById('laser-container');
            
            // é‡ç½®çŠ¶æ€
            continueBtn.classList.add('hide');
            laserContainer.innerHTML = '';
            
            // è®¾ç½®ç©å®¶1é£æœºä¿¡æ¯
            const emoji1 = document.getElementById('battle-emoji1');
            emoji1.textContent = player1.plane.emoji;
            document.getElementById('battle-name1').textContent = player1.plane.name;
            const healthFill1 = document.getElementById('health-fill1');
            const healthPercent1 = (player1.plane.health / 100) * 100;
            healthFill1.style.width = `${healthPercent1}%`;
            healthFill1.textContent = player1.plane.health;
            document.getElementById('health-value1').textContent = `${player1.plane.health} è¡€é‡`;
            
            // è®¾ç½®ç©å®¶2é£æœºä¿¡æ¯
            const emoji2 = document.getElementById('battle-emoji2');
            emoji2.textContent = player2.plane.emoji;
            document.getElementById('battle-name2').textContent = player2.plane.name;
            const healthFill2 = document.getElementById('health-fill2');
            const healthPercent2 = (player2.plane.health / 100) * 100;
            healthFill2.style.width = `${healthPercent2}%`;
            healthFill2.textContent = player2.plane.health;
            document.getElementById('health-value2').textContent = `${player2.plane.health} è¡€é‡`;
            
            // æ˜¾ç¤ºå¯¹å†³æ¨¡æ€æ¡†
            modal.classList.remove('hide');
            
            // å»¶è¿Ÿåå¼€å§‹æˆ˜æ–—åŠ¨ç”»
            setTimeout(() => {
                const resultElement = document.getElementById('battle-result');
                let resultText = '';
                let winner, loser, winnerEmoji, loserEmoji;
                
                // æ¯”è¾ƒè¡€é‡
                if (player1.plane.health > player2.plane.health) {
                    gameState.player1Score++;
                    resultText = 'ğŸ‰ ç©å®¶1è·èƒœï¼';
                    winner = player1;
                    loser = player2;
                    winnerEmoji = emoji1;
                    loserEmoji = emoji2;
                } else if (player1.plane.health < player2.plane.health) {
                    gameState.player2Score++;
                    resultText = 'ğŸ‰ ç©å®¶2è·èƒœï¼';
                    winner = player2;
                    loser = player1;
                    winnerEmoji = emoji2;
                    loserEmoji = emoji1;
                } else {
                    resultText = 'ğŸ¤ å¹³å±€ï¼';
                }
                
                // å¦‚æœä¸æ˜¯å¹³å±€ï¼Œæ’­æ”¾æˆ˜æ–—åŠ¨ç”»
                if (winner && loser) {
                    // 1. è°ƒæ•´å¯¼å¼¹å®¹å™¨ä½ç½®å’Œæ ·å¼
                    laserContainer.style.height = '100px';
                    
                    // 2. è·å–é£æœºå…ƒç´ çš„ä½ç½®
                    const winnerEmojiRect = winnerEmoji.getBoundingClientRect();
                    const loserEmojiRect = loserEmoji.getBoundingClientRect();
                    const containerRect = laserContainer.getBoundingClientRect();
                    
                    // 3. è®¡ç®—å¯¼å¼¹çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆç›¸å¯¹äºå®¹å™¨ï¼‰
                    // å¯¼å¼¹å®½åº¦60pxï¼Œé«˜åº¦12px
                    const startX = winner === player1 ? winnerEmojiRect.right - containerRect.left : winnerEmojiRect.left - containerRect.left - 60;
                    const startY = (winnerEmojiRect.top + winnerEmojiRect.bottom) / 2 - containerRect.top - 6;
                    const endX = winner === player1 ? loserEmojiRect.left - containerRect.left : loserEmojiRect.right - containerRect.left - 60;
                    const endY = (loserEmojiRect.top + loserEmojiRect.bottom) / 2 - containerRect.top - 6;
                    
                    // 4. è®¡ç®—ä¸­é—´ç‚¹
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    
                    // 5. æ·»åŠ å¯¼å¼¹
                    const missile = document.createElement('div');
                    missile.className = 'missile missile-fly';
                    
                    // è®¾ç½®å¯¼å¼¹åˆå§‹ä½ç½®
                    missile.style.left = `${startX}px`;
                    missile.style.top = `${startY}px`;
                    
                    // è®¾ç½®CSSå˜é‡ç”¨äºåŠ¨ç”»
                    missile.style.setProperty('--mid-x', `${midX - startX}px`);
                    missile.style.setProperty('--mid-y', `${midY - startY}px`);
                    missile.style.setProperty('--end-x', `${endX - startX}px`);
                    missile.style.setProperty('--end-y', `${endY - startY}px`);
                    
                    // è®¾ç½®å¯¼å¼¹æ—‹è½¬è§’åº¦ï¼Œä½¿å…¶æŒ‡å‘ç›®æ ‡
                    const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                    missile.style.transform = `translateX(0) translateY(0) scale(0.5) rotate(${angle}deg)`;
                    // åŠ¨ç”»è¿‡ç¨‹ä¸­ä¿æŒæ—‹è½¬è§’åº¦ä¸å˜
                    missile.style.setProperty('--rotation', `${angle}deg`);
                    
                    laserContainer.appendChild(missile);
                    
                    // 6. èƒœåˆ©è€…éœ‡åŠ¨
                    winnerEmoji.classList.add('plane-shake');
                    
                    // 7. å»¶è¿Ÿåå¤±è´¥è€…çˆ†ç‚¸ï¼ˆè®©å¯¼å¼¹åŠ¨ç”»å®Œæ•´æ’­æ”¾ï¼‰
                    setTimeout(() => {
                        // ç§»é™¤éœ‡åŠ¨æ•ˆæœ
                        winnerEmoji.classList.remove('plane-shake');
                        
                        // ç§»é™¤å¯¼å¼¹
                        missile.remove();
                        
                        // å¤±è´¥è€…çˆ†ç‚¸ï¼ˆç °åœ°ä¸€å£°ï¼‰
                        loserEmoji.classList.add('plane-explode');
                        
                        // 8. çˆ†ç‚¸åæ¶ˆå¤±ï¼Œç„¶åæ˜¾ç¤ºç»“æœ
                        setTimeout(() => {
                            // å…ˆè®©å¤±è´¥è€…é£æœºæ¶ˆå¤±
                            loserEmoji.classList.add('plane-disappear');
                            
                            // 9. æ˜¾ç¤ºç»“æœ
                            setTimeout(() => {
                                resultElement.textContent = resultText;
                                
                                // 10. æ›´æ–°åˆ†æ•°
                                document.getElementById('player1-score').textContent = gameState.player1Score;
                                document.getElementById('player2-score').textContent = gameState.player2Score;
                                
                                // 11. æ˜¾ç¤ºç»§ç»­æŒ‰é’®
                                continueBtn.classList.remove('hide');
                            }, 800); // åŒ¹é…æ¶ˆå¤±åŠ¨ç”»æ—¶é•¿
                        }, 800); // åŒ¹é…çˆ†ç‚¸åŠ¨ç”»æ—¶é•¿
                    }, 1200); // åŒ¹é…å¯¼å¼¹åŠ¨ç”»æ—¶é•¿
                } else {
                    // å¹³å±€æƒ…å†µ
                    resultElement.textContent = resultText;
                    document.getElementById('player1-score').textContent = gameState.player1Score;
                    document.getElementById('player2-score').textContent = gameState.player2Score;
                    continueBtn.classList.remove('hide');
                }
            }, 1000);
        }
        
        // ç»§ç»­æ¸¸æˆ
        function continueGame() {
            const modal = document.getElementById('battle-modal');
            modal.classList.add('hide');
            
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            const emoji1 = document.getElementById('battle-emoji1');
            const emoji2 = document.getElementById('battle-emoji2');
            emoji1.classList.remove('plane-shake', 'plane-explode', 'plane-disappear');
            emoji2.classList.remove('plane-shake', 'plane-explode', 'plane-disappear');
            document.getElementById('laser-container').innerHTML = '';
            document.getElementById('battle-result').textContent = '';
            
            // æ­ç¤ºé€‰ä¸­çš„é£æœº
            gameState.selectedPlanes.forEach(selection => {
                const { col, row } = selection;
                gameState.board[col][row].revealed = true;
                gameState.board[col][row].selected = false;
            });
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.selectedPlanes = [];
            gameState.currentPlayer = 1;
            gameState.roundCount++;
            gameState.revealedCount += 2;
            
            // æ›´æ–°ç•Œé¢
            document.getElementById('game-status').textContent = 'ç©å®¶1ï¼Œè¯·é€‰æ‹©ä½ çš„é£æœº';
            document.getElementById('round-count').textContent = gameState.roundCount;
            renderBoard();
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.revealedCount >= gameState.totalPlanes) {
                setTimeout(() => {
                    endGame();
                }, 1000);
            }
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            const modal = document.getElementById('result-modal');
            const title = document.getElementById('result-title');
            const text = document.getElementById('result-text');
            
            let winner = '';
            if (gameState.player1Score > gameState.player2Score) {
                winner = 'ç©å®¶1';
                title.textContent = 'ğŸ‰ ç©å®¶1è·èƒœï¼';
            } else if (gameState.player1Score < gameState.player2Score) {
                winner = 'ç©å®¶2';
                title.textContent = 'ğŸ‰ ç©å®¶2è·èƒœï¼';
            } else {
                title.textContent = 'ğŸ¤ å¹³å±€ï¼';
            }
            
            text.textContent = `ç©å®¶1: ${gameState.player1Score} èƒœ | ç©å®¶2: ${gameState.player2Score} èƒœ | æ€»è½®æ¬¡: ${gameState.roundCount}`;
            modal.classList.remove('hide');
        }
        
        // æ–°æ¸¸æˆ
        function newGame() {
            gameState = {
                board: initBoard(),
                player1Score: 0,
                player2Score: 0,
                currentPlayer: 1,
                selectedPlanes: [],
                roundCount: 0,
                revealedCount: 0,
                totalPlanes: 40
            };
            
            // æ›´æ–°ç•Œé¢
            document.getElementById('player1-score').textContent = '0';
            document.getElementById('player2-score').textContent = '0';
            document.getElementById('round-count').textContent = '0';
            document.getElementById('game-status').textContent = 'ç©å®¶1ï¼Œè¯·é€‰æ‹©ä½ çš„é£æœº';
            
            // éšè—æ¨¡æ€æ¡†
            document.getElementById('result-modal').classList.add('hide');
            document.getElementById('battle-modal').classList.add('hide');
            
            // æ¸²æŸ“æ¸¸æˆæ¿
            renderBoard();
        }
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('continue-btn').addEventListener('click', continueGame);
        document.getElementById('play-again').addEventListener('click', newGame);
        
        // åˆå§‹åŒ–æ¸¸æˆ
        newGame();
    </script>
</body>
</html>
